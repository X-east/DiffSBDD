# å¿«é€Ÿå¼€å§‹æŒ‡å— - RE-CmeBè›‹ç™½åˆ†å­ä¼˜åŒ–

## 30ç§’å¿«é€Ÿå¼€å§‹

```bash
# 1. ç¯å¢ƒè®¾ç½®
cd iterative_learning
./setup_environment.sh

# 2. æ£€æŸ¥ç¯å¢ƒ
conda activate diffsbdd
python check_setup.py

# 3. å‡†å¤‡è›‹ç™½æ–‡ä»¶ï¼ˆæ›¿æ¢ä¸ºä½ çš„æ–‡ä»¶ï¼‰
cp /path/to/your/RE-CmeB.pdb proteins/

# 4. é…ç½®å¹¶è¿è¡Œ
nano run_example.sh  # ç¼–è¾‘é…ç½®
./run_example.sh     # å¼€å§‹è¿è¡Œ
```

## è¯¦ç»†æ­¥éª¤

### æ­¥éª¤1: ç¯å¢ƒè®¾ç½®ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

```bash
cd iterative_learning
chmod +x setup_environment.sh
./setup_environment.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ“ åˆ›å»ºcondaç¯å¢ƒï¼ˆdiffsbddï¼‰
- âœ“ ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹ï¼ˆ~500MBï¼‰
- âœ“ åˆ›å»ºå¿…è¦çš„ç›®å½•
- âœ“ å¯é€‰å®‰è£…sminaï¼ˆå¯¹æ¥è½¯ä»¶ï¼‰

**æ—¶é—´**: çº¦10-20åˆ†é’Ÿï¼ˆå–å†³äºç½‘é€Ÿï¼‰

### æ­¥éª¤2: éªŒè¯ç¯å¢ƒ

```bash
conda activate diffsbdd
python check_setup.py
```

æ£€æŸ¥è¾“å‡ºåº”è¯¥æ˜¾ç¤ºæ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼š
```
====================================================================
æ£€æŸ¥æ€»ç»“
====================================================================
Pythonç‰ˆæœ¬            âœ“ é€šè¿‡
PythonåŒ…              âœ“ é€šè¿‡
CUDA                  âœ“ é€šè¿‡
æ ¸å¿ƒæ–‡ä»¶              âœ“ é€šè¿‡
DiffSBDDæ¨¡å—          âœ“ é€šè¿‡
é¢„è®­ç»ƒæ¨¡å‹            âœ“ é€šè¿‡
====================================================================
âœ“ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼å¯ä»¥å¼€å§‹è¿è¡Œè¿­ä»£å­¦ä¹ ç³»ç»Ÿ
```

### æ­¥éª¤3: å‡†å¤‡æ•°æ®

#### 3.1 å‡†å¤‡PDBæ–‡ä»¶

å°†RE-CmeBè›‹ç™½çš„PDBæ–‡ä»¶æ”¾åˆ° `proteins/` ç›®å½•ï¼š

```bash
cp /path/to/RE-CmeB.pdb proteins/
```

**PDBæ–‡ä»¶è¦æ±‚**ï¼š
- âœ“ æ ‡å‡†PDBæ ¼å¼
- âœ“ åŒ…å«è›‹ç™½è´¨åæ ‡
- âœ“ æœ€å¥½åŒ…å«æ°¢åŸå­ï¼ˆç”¨äºå¯¹æ¥ï¼‰
- âœ“ æ¸…é™¤äº†æ°´åˆ†å­å’Œå…¶ä»–æ‚è´¨

#### 3.2 ç¡®å®šå£è¢‹å®šä¹‰

æœ‰ä¸¤ç§æ–¹å¼å®šä¹‰ç»“åˆå£è¢‹ï¼š

**æ–¹å¼A: ä½¿ç”¨å‚è€ƒé…ä½“**ï¼ˆæ¨èï¼Œå¦‚æœPDBä¸­æœ‰é…ä½“ï¼‰

```bash
# æŸ¥çœ‹PDBæ–‡ä»¶ä¸­çš„é…ä½“ä½ç½®
# ä¾‹å¦‚ï¼šé…ä½“åœ¨é“¾Açš„330å·æ®‹åŸº
REF_LIGAND="A:330"

# æˆ–è€…ä½¿ç”¨å•ç‹¬çš„SDFæ–‡ä»¶
REF_LIGAND="path/to/reference_ligand.sdf"
```

**æ–¹å¼B: æ‰‹åŠ¨æŒ‡å®šå£è¢‹æ®‹åŸº**

```bash
# åˆ—å‡ºæ„æˆå£è¢‹çš„æ®‹åŸºï¼ˆæ ¼å¼ï¼šé“¾:æ®‹åŸºå·ï¼‰
POCKET_IDS="A:50,A:51,A:52,A:87,A:88,A:89"
```

### æ­¥éª¤4: é…ç½®å‚æ•°

**æ–¹å¼Aï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰** â­ NEW

ç¼–è¾‘ `config.yaml`ï¼š

```bash
nano config.yaml
```

```yaml
paths:
  pdbfile: "./proteins/RE-CmeB.pdb"      # ä½ çš„è›‹ç™½æ–‡ä»¶
  output_dir: "./results/RE-CmeB_iterative"

pocket:
  ref_ligand: "A:330"                    # ä½ çš„å£è¢‹å®šä¹‰

iteration:
  n_iterations: 30      # è¿­ä»£æ¬¡æ•°
  train_epochs: 50      # è®­ç»ƒè½®æ•°
  freeze_layers: 3      # å†»ç»“å±‚æ•°ï¼ˆå…±5å±‚ï¼‰

training:
  batch_size: 8         # æ‰¹æ¬¡å¤§å°ï¼ˆæ ¹æ®GPUè°ƒæ•´ï¼‰
```

**æ–¹å¼Bï¼šç¼–è¾‘è¿è¡Œè„šæœ¬**

ç¼–è¾‘ `run_example.sh`ï¼š

```bash
# === å¿…é¡»ä¿®æ”¹ ===
PDBFILE="./proteins/RE-CmeB.pdb"     # ä½ çš„è›‹ç™½æ–‡ä»¶
REF_LIGAND="A:330"                   # ä½ çš„å£è¢‹å®šä¹‰

# === å¯é€‰è°ƒæ•´ ===
N_ITERATIONS=30      # è¿­ä»£æ¬¡æ•°ï¼ˆæ¨è30ï¼‰
TRAIN_EPOCHS=50      # æ¯æ¬¡è®­ç»ƒè½®æ•°ï¼ˆæ¨è50ï¼‰
FREEZE_LAYERS=3      # å†»ç»“å±‚æ•°ï¼ˆå…±5å±‚ï¼Œæ¨è3ï¼‰
BATCH_SIZE=8         # æ‰¹æ¬¡å¤§å°ï¼ˆæ ¹æ®GPUå†…å­˜è°ƒæ•´ï¼‰
```

**æ ¹æ®GPUå†…å­˜è°ƒæ•´**ï¼š

| GPUæ˜¾å­˜ | æ¨èbatch_size | é¢„è®¡æ—¶é—´/è¿­ä»£ |
|---------|---------------|--------------|
| 8GB     | 4             | ~2å°æ—¶       |
| 12GB    | 8             | ~1.5å°æ—¶     |
| 24GB+   | 16            | ~1å°æ—¶       |

### æ­¥éª¤5: è¿è¡Œ

**ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰**ï¼š

```bash
python iterative_generation.py --config config.yaml
```

**æˆ–ä½¿ç”¨é¢„è®¾**ï¼š

```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆ3æ¬¡è¿­ä»£ï¼‰
python iterative_generation.py --preset quick_test

# é«˜è´¨é‡æ¨¡å¼
python iterative_generation.py --preset high_quality
```

**æˆ–ä½¿ç”¨Shellè„šæœ¬**ï¼š

```bash
chmod +x run_example.sh
./run_example.sh
```

**è¿è¡Œæ—¶ä¼šçœ‹åˆ°**ï¼š
```
==========================================
RE-CmeBè›‹ç™½è¿­ä»£å­¦ä¹ 
==========================================
æ¨¡å‹: ./checkpoints/crossdocked_fullatom_cond.ckpt
è›‹ç™½: ./proteins/RE-CmeB.pdb
è¾“å‡º: ./results/RE-CmeB_iterative
è¿­ä»£æ¬¡æ•°: 30
==========================================

å¼€å§‹ç¬¬ 1 æ¬¡è¿­ä»£...
ç”Ÿæˆ 2000 ä¸ªåˆ†å­...
æˆåŠŸç”Ÿæˆ 1856 ä¸ªæœ‰æ•ˆåˆ†å­
è¯„ä¼°åˆ†å­...
é€‰æ‹©æœ€ä¼˜çš„ 1000 ä¸ªåˆ†å­...
è®­ç»ƒæ¨¡å‹...
...
```

**é¢„è®¡æ€»æ—¶é—´**ï¼š
- 30æ¬¡è¿­ä»£ Ã— 1.5å°æ—¶/è¿­ä»£ = **çº¦45å°æ—¶**ï¼ˆä½¿ç”¨12GB GPUï¼‰
- å¯ä»¥ä¸­é€”åœæ­¢ï¼Œç»“æœå·²è‡ªåŠ¨ä¿å­˜

### æ­¥éª¤6: æŸ¥çœ‹ç»“æœ

è¿è¡Œå®Œæˆåï¼ŒæŸ¥çœ‹è¾“å‡ºç›®å½•ï¼š

```bash
cd results/RE-CmeB_iterative

# æŸ¥çœ‹æœ€ç»ˆæŠ¥å‘Š
cat final_report.txt

# æŸ¥çœ‹è¿­ä»£å†å²
cat logs/iteration_history.csv

# æœ€ä¼˜åˆ†å­ï¼ˆSDFæ ¼å¼ï¼‰
# å¯ç”¨PyMOLã€RDKitç­‰å¯è§†åŒ–å·¥å…·æ‰“å¼€
ls molecules/iteration_30_selected.sdf
```

## æ–‡ä»¶ç»“æ„è¯´æ˜

```
iterative_learning/
â”œâ”€â”€ ğŸ“„ æ ¸å¿ƒç¨‹åº
â”‚   â”œâ”€â”€ iterative_generation.py      ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ molecule_evaluator.py        åˆ†å­è¯„ä¼°å™¨
â”‚   â”œâ”€â”€ prepare_training_data.py     æ•°æ®å‡†å¤‡
â”‚   â””â”€â”€ train_frozen.py              å†»ç»“è®­ç»ƒ
â”‚
â”œâ”€â”€ ğŸ”§ è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ run_example.sh               è¿è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ setup_environment.sh         ç¯å¢ƒè®¾ç½®
â”‚   â””â”€â”€ check_setup.py              ç¯å¢ƒæ£€æŸ¥
â”‚
â”œâ”€â”€ ğŸ“– æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                    è¯¦ç»†æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰
â”‚   â”œâ”€â”€ ä½¿ç”¨è¯´æ˜.txt                 å¿«é€ŸæŒ‡å—ï¼ˆä¸­æ–‡ï¼‰
â”‚   â”œâ”€â”€ å¿«é€Ÿå¼€å§‹æŒ‡å—.md              æœ¬æ–‡ä»¶
â”‚   â””â”€â”€ PROJECT_OVERVIEW.md          é¡¹ç›®æ€»è§ˆ
â”‚
â””â”€â”€ ğŸ“‚ å·¥ä½œç›®å½•
    â”œâ”€â”€ checkpoints/                 é¢„è®­ç»ƒæ¨¡å‹
    â”œâ”€â”€ proteins/                    è›‹ç™½PDBæ–‡ä»¶
    â””â”€â”€ results/                     è¾“å‡ºç»“æœ
```

## å¸¸è§é—®é¢˜

### Q1: è¿è¡Œæ—¶æç¤º"CUDA out of memory"

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# åœ¨run_example.shä¸­å‡å°æ‰¹æ¬¡å¤§å°
BATCH_SIZE=4  # æˆ–æ›´å°
```

### Q2: å¦‚ä½•æš‚åœå’Œç»§ç»­ï¼Ÿâ­ NEW

**å›ç­”**ï¼š
- å¯ä»¥éšæ—¶æŒ‰Ctrl+Cåœæ­¢
- æ‰€æœ‰ç»“æœå·²è‡ªåŠ¨ä¿å­˜ï¼ŒåŒ…æ‹¬è®­ç»ƒçŠ¶æ€
- ä½¿ç”¨ `--resume_from` å‚æ•°ä»æŒ‡å®šè¿­ä»£ç»§ç»­ï¼š

```bash
# æ–¹æ³•1ï¼šç¼–è¾‘ run_example.sh
RESUME_FROM="--resume_from 5"  # ä»ç¬¬5æ¬¡è¿­ä»£ç»§ç»­

# æ–¹æ³•2ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤
python iterative_generation.py \
    --checkpoint checkpoints/crossdocked_fullatom_cond.ckpt \
    --pdbfile proteins/RE-CmeB.pdb \
    --output_dir results/RE-CmeB_iterative \
    --ref_ligand A:330 \
    --n_iterations 30 \
    --resume_from 5 \  # ä»è¿™é‡Œæ¢å¤
    --continue_on_error
```

### Q3: ä¸ä½¿ç”¨å¯¹æ¥æ‰“åˆ†å¯ä»¥å—ï¼Ÿ

**å›ç­”**ï¼š
- å¯ä»¥ï¼ç§»é™¤ `--use_docking` å‚æ•°å³å¯
- ç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒæ•´å…¶ä»–æŒ‡æ ‡çš„æƒé‡

### Q4: å¦‚ä½•æŸ¥çœ‹è¿›åº¦ï¼Ÿ

**å›ç­”**ï¼š
```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f results/RE-CmeB_iterative/logs/iteration_history.csv

# æŸ¥çœ‹å·²ç”Ÿæˆçš„åˆ†å­æ•°é‡
ls -lh results/RE-CmeB_iterative/molecules/
```

### Q5: ç»“æœä¸ç†æƒ³æ€ä¹ˆåŠï¼Ÿ

**è°ƒä¼˜å»ºè®®**ï¼š
1. å¢åŠ è®­ç»ƒè½®æ•°ï¼š`TRAIN_EPOCHS=100`
2. ä½¿ç”¨å¯¹æ¥æ‰“åˆ†ï¼š`USE_DOCKING="--use_docking"`
3. è°ƒæ•´è¯„åˆ†æƒé‡ï¼ˆç¼–è¾‘ `molecule_evaluator.py`ï¼‰
4. æ£€æŸ¥å£è¢‹å®šä¹‰æ˜¯å¦å‡†ç¡®

## é«˜çº§ç”¨æ³•

### ä»…è¿è¡Œéƒ¨åˆ†è¿­ä»£

```bash
# åªè¿è¡Œ10æ¬¡è¿­ä»£è¿›è¡Œæµ‹è¯•
python iterative_generation.py \
    --checkpoint checkpoints/crossdocked_fullatom_cond.ckpt \
    --pdbfile proteins/RE-CmeB.pdb \
    --output_dir results/test_run \
    --ref_ligand A:330 \
    --n_iterations 10 \
    --train_epochs 30
```

### è‡ªå®šä¹‰è¯„åˆ†æƒé‡

ç¼–è¾‘ `molecule_evaluator.py` ç¬¬22-28è¡Œï¼š

```python
self.weights = {
    'QED': 0.3,      # å¢åŠ ç±»è¯æ€§é‡è¦æ€§
    'SA': 0.2,       # é™ä½åˆæˆå¯åŠæ€§
    'LogP': 0.1,
    'Lipinski': 0.1,
    'Docking': 0.3   # å¢åŠ å¯¹æ¥æ‰“åˆ†é‡è¦æ€§
}
```

### å¹¶è¡Œè¿è¡Œå¤šä¸ªè›‹ç™½

```bash
# ä¸ºä¸åŒè›‹ç™½åˆ›å»ºä¸åŒçš„è¿è¡Œè„šæœ¬
cp run_example.sh run_protein1.sh
cp run_example.sh run_protein2.sh

# ä¿®æ”¹è¾“å‡ºç›®å½•é¿å…å†²çª
# åœ¨ä¸åŒç»ˆç«¯ä¸­è¿è¡Œ
```

### å¯è§†åŒ–ç»“æœ

ä½¿ç”¨Pythonå’ŒRDKitï¼š

```python
from rdkit import Chem
from rdkit.Chem import Draw
import pandas as pd

# è¯»å–åˆ†å­
suppl = Chem.SDMolSupplier('results/RE-CmeB_iterative/molecules/iteration_30_selected.sdf')
mols = [mol for mol in suppl if mol is not None]

# è¯»å–è¯„åˆ†
scores = pd.read_csv('results/RE-CmeB_iterative/logs/iteration_30_scores.csv')

# å¯è§†åŒ–top 10
top_mols = mols[:10]
img = Draw.MolsToGridImage(top_mols, molsPerRow=5, subImgSize=(300,300))
img.save('top10_molecules.png')

# æ‰“å°ç»Ÿè®¡
print(scores[['QED', 'SA', 'LogP', 'Docking_Score']].describe())
```

## æ€§èƒ½åŸºå‡†

åŸºäºæµ‹è¯•ç»éªŒï¼š

| ç¡¬ä»¶é…ç½® | å•æ¬¡è¿­ä»£æ—¶é—´ | 30æ¬¡è¿­ä»£æ€»æ—¶é—´ |
|---------|------------|---------------|
| RTX 3090 (24GB) | ~1å°æ—¶ | ~30å°æ—¶ |
| RTX 3080 (12GB) | ~1.5å°æ—¶ | ~45å°æ—¶ |
| GTX 1080 Ti (11GB) | ~2å°æ—¶ | ~60å°æ—¶ |
| CPU only | ~8å°æ—¶ | ~240å°æ—¶ |

## ä¸‹ä¸€æ­¥

è¿è¡Œå®Œæˆåï¼Œä½ å¯ä»¥ï¼š

1. **åˆ†æç»“æœ**: æŸ¥çœ‹æœ€ç»ˆæŠ¥å‘Šå’Œè¯„åˆ†æ–‡ä»¶
2. **å¯è§†åŒ–**: ä½¿ç”¨PyMOLç­‰å·¥å…·æŸ¥çœ‹ç”Ÿæˆçš„åˆ†å­
3. **è¿›ä¸€æ­¥ç­›é€‰**: æ ¹æ®ç‰¹å®šéœ€æ±‚ä»1000ä¸ªæœ€ä¼˜åˆ†å­ä¸­ç²¾é€‰
4. **å®éªŒéªŒè¯**: é€‰æ‹©æœ€æœ‰å¸Œæœ›çš„åˆ†å­è¿›è¡Œå®éªŒåˆæˆå’Œæµ‹è¯•
5. **ç»§ç»­ä¼˜åŒ–**: åŸºäºå®éªŒç»“æœè°ƒæ•´å‚æ•°é‡æ–°è¿è¡Œ

## è·å–å¸®åŠ©

- ğŸ“– æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£: `cat README.md`
- ğŸ” æŸ¥çœ‹é¡¹ç›®æ€»è§ˆ: `cat PROJECT_OVERVIEW.md`
- â“ é‡åˆ°é—®é¢˜: æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ `results/*/logs/`

---

**ç¥æ‚¨åœ¨è¯ç‰©è®¾è®¡ç ”ç©¶ä¸­å–å¾—æˆåŠŸï¼** ğŸ‰

