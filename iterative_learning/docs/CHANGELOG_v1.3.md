# CHANGELOG v1.3

**å‘å¸ƒæ—¥æœŸ**: 2024-11-03  
**ç‰ˆæœ¬**: v1.3  
**ç±»å‹**: é‡è¦Bugä¿®å¤ç‰ˆæœ¬ + åŠŸèƒ½å¢å¼º

---

## æ¦‚è¿°

v1.3 æ˜¯ä¸€ä¸ªé‡è¦çš„ç»´æŠ¤ç‰ˆæœ¬ï¼Œä¿®å¤äº†å¤šä¸ªå½±å“ç¨‹åºç¨³å®šæ€§å’Œæ­£ç¡®æ€§çš„å…³é”®bugï¼Œå¹¶æ–°å¢äº†é…ç½®æ–‡ä»¶æ”¯æŒåŠŸèƒ½ã€‚æœ¬æ¬¡æ›´æ–°ç¡®ä¿äº†ç³»ç»Ÿçš„å¯é æ€§å’Œæ˜“ç”¨æ€§ã€‚

## âš ï¸ é‡è¦ä¿®å¤

### ğŸ”´ ä¸¥é‡Bugä¿®å¤ï¼ˆä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼‰

#### 1. **ä¿®å¤ iterative_generation.py ç¬¬441è¡Œæœªå®šä¹‰å˜é‡é”™è¯¯**
- **é—®é¢˜**: åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶ï¼Œ`prev_molecules` å˜é‡æœªå®šä¹‰å°±è¢«ä½¿ç”¨ï¼Œå¯¼è‡´ `NameError`
- **å½±å“**: ç¨‹åºåœ¨è®°å½•è¿­ä»£ç»Ÿè®¡ä¿¡æ¯æ—¶å´©æºƒ
- **ä¿®å¤**: åœ¨ä½¿ç”¨å‰ä¿å­˜ `candidate_molecules` çš„é•¿åº¦
- **ä½ç½®**: `iterative_generation.py:441`

**ä¿®å¤å‰**:
```python
'n_candidates': len(prev_molecules) + len(new_molecules) if iteration > 1 else n_generate,
```

**ä¿®å¤å**:
```python
# ä¿å­˜å€™é€‰æ•°é‡ï¼ˆç”¨äºç»Ÿè®¡ï¼‰
n_candidates = len(candidate_molecules)
# ...
'n_candidates': n_candidates,
```

---

#### 2. **ä¿®å¤ prepare_training_data.py ç¬¬69è¡Œæ¯”è¾ƒé”™è¯¯**
- **é—®é¢˜**: å½“ä½¿ç”¨SDFæ–‡ä»¶ä½œä¸ºå‚è€ƒé…ä½“æ—¶ï¼Œ`resi = None`ï¼Œå¯¼è‡´æ— æ³•æ­£ç¡®è·³è¿‡é…ä½“æ®‹åŸº
- **å½±å“**: å£è¢‹å®šä¹‰ä¸æ­£ç¡®ï¼Œå¯èƒ½åŒ…å«é…ä½“æœ¬èº«
- **ä¿®å¤**: æ·»åŠ  `resi is not None` æ£€æŸ¥
- **ä½ç½®**: `prepare_training_data.py:69-71`

**ä¿®å¤å‰**:
```python
if residue.id[1] == resi:
    continue  # è·³è¿‡é…ä½“æœ¬èº«
```

**ä¿®å¤å**:
```python
# è·³è¿‡é…ä½“æœ¬èº«ï¼ˆä»…å½“é…ä½“åœ¨PDBä¸­æ—¶ï¼‰
if resi is not None and residue.id[1] == resi:
    continue
```

---

#### 3. **å®ç° config.yaml é…ç½®æ–‡ä»¶åŠ è½½åŠŸèƒ½** â­ NEW
- **é—®é¢˜**: READMEå¤§é‡æåˆ°é…ç½®æ–‡ä»¶ä½¿ç”¨ï¼Œä½†ä»£ç ä¸æ”¯æŒ `--config` å’Œ `--preset` å‚æ•°
- **å½±å“**: ç”¨æˆ·æŒ‰ç…§æ–‡æ¡£ä½¿ç”¨é…ç½®æ–‡ä»¶ä¼šæŠ¥é”™
- **ä¿®å¤**: å®Œæ•´å®ç°é…ç½®æ–‡ä»¶å’Œé¢„è®¾åŠ è½½æœºåˆ¶
- **ä½ç½®**: `iterative_generation.py:559-748`

**æ–°å¢åŠŸèƒ½**:
- âœ… æ”¯æŒ `--config` å‚æ•°åŠ è½½ YAML é…ç½®æ–‡ä»¶
- âœ… æ”¯æŒ `--preset` å‚æ•°ä½¿ç”¨é¢„è®¾é…ç½®ï¼ˆ`quick_test`, `high_quality`, `fast_training`ï¼‰
- âœ… å‘½ä»¤è¡Œå‚æ•°ä¼˜å…ˆçº§é«˜äºé…ç½®æ–‡ä»¶
- âœ… è‡ªåŠ¨åˆå¹¶é¢„è®¾åˆ°é…ç½®

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶
python iterative_generation.py --config config.yaml

# ä½¿ç”¨é¢„è®¾
python iterative_generation.py --preset quick_test

# é…ç½®æ–‡ä»¶ + é¢„è®¾
python iterative_generation.py --config config.yaml --preset high_quality

# é…ç½®æ–‡ä»¶ + å‘½ä»¤è¡Œè¦†ç›–
python iterative_generation.py --config config.yaml --batch_size 16
```

---

### ğŸŸ¡ é€»è¾‘é”™è¯¯ä¿®å¤ï¼ˆå½±å“ç»“æœæ­£ç¡®æ€§ï¼‰

#### 4. **ä¿®å¤ molecule_evaluator.py æƒé‡ä¿®æ”¹bug**
- **é—®é¢˜**: æƒé‡å­—å…¸è¢«åŸåœ°ä¿®æ”¹ï¼Œå¯¼è‡´åç»­åˆ›å»ºçš„è¯„ä¼°å™¨å®ä¾‹æƒé‡å¼‚å¸¸
- **å½±å“**: å¤šæ¬¡è¯„ä¼°æ—¶æƒé‡è®¡ç®—é”™è¯¯
- **ä¿®å¤**: åˆ›å»ºæ–°å­—å…¸è€Œä¸æ˜¯ä¿®æ”¹åŸå­—å…¸
- **ä½ç½®**: `molecule_evaluator.py:57-64`

**ä¿®å¤å‰**:
```python
for k in self.weights:
    if k != 'Docking':
        self.weights[k] = self.weights[k] / total  # ç›´æ¥ä¿®æ”¹
```

**ä¿®å¤å**:
```python
self.weights = {
    k: (v / total if k != 'Docking' else 0.0)
    for k, v in self.weights.items()
}  # åˆ›å»ºæ–°å­—å…¸
```

---

#### 5. **ä¿®å¤ uncertainty_selector.py æ•°æ®ä¸ä¸€è‡´**
- **é—®é¢˜**: `known_fps` å’Œ `known_smiles` çš„è¿‡æ»¤æ¡ä»¶ä¸åŒï¼Œå¯¼è‡´é•¿åº¦ä¸åŒ¹é…
- **å½±å“**: åç»­è¿­ä»£çš„ç›¸ä¼¼åº¦è®¡ç®—é”™è¯¯ï¼Œæ¢ç´¢/åˆ©ç”¨å¹³è¡¡å¤±æ•ˆ
- **ä¿®å¤**: åŒæ—¶è¿‡æ»¤ä¸¤è€…ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **ä½ç½®**: `uncertainty_selector.py:327-346`

**ä¿®å¤å‰**:
```python
new_fps = [candidate_fps[i] for i in selected_indices if candidate_fps[i] is not None]
new_smiles = [Chem.MolToSmiles(mol) for mol in selected_molecules if mol is not None]
```

**ä¿®å¤å**:
```python
# åŒæ—¶è¿‡æ»¤æŒ‡çº¹å’ŒSMILESï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
new_data = []
for i, mol in zip(selected_indices, selected_molecules):
    if candidate_fps[i] is not None and mol is not None:
        try:
            smiles = Chem.MolToSmiles(mol)
            new_data.append((candidate_fps[i], smiles))
        except Exception as e:
            self.logger.debug(f"è½¬æ¢SMILESå¤±è´¥: {e}")
            continue

new_fps = [fp for fp, _ in new_data]
new_smiles = [smi for _, smi in new_data]
```

---

### ğŸŸ  æ€§èƒ½ä¼˜åŒ–

#### 6. **æ”¹è¿›å†…å­˜ç®¡ç†**
- **é—®é¢˜**: åˆ†å­æ± èµ‹å€¼å‰æœªæ¸…ç†æ—§æ•°æ®ï¼Œå¯¼è‡´å†…å­˜å ç”¨æŒç»­å¢é•¿
- **å½±å“**: é•¿æ—¶é—´è¿è¡Œå¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³
- **ä¿®å¤**: åœ¨èµ‹å€¼å‰æ˜¾å¼æ¸…ç†æ—§æ± 
- **ä½ç½®**: `iterative_generation.py:308-311`

**ä¿®å¤å**:
```python
# å­˜å‚¨åˆ°å†…å­˜æ± ï¼ˆç”¨äºåç»­è¿­ä»£ï¼‰
# æ¸…ç†æ—§çš„æ± ä»¥é‡Šæ”¾å†…å­˜
self.current_molecules_pool.clear()
self.current_molecules_pool = selected_molecules
```

---

### ğŸ”§ ä»£ç è´¨é‡æ”¹è¿›

#### 7. **ç¡®ä¿éšæœºæ€§å¯é‡ç°**
- **é—®é¢˜**: fallbackè·¯å¾„ç¼ºå°‘æ³¨é‡Šè¯´æ˜
- **æ”¹è¿›**: æ·»åŠ æ³¨é‡Šæ˜ç¡®éšæœºç§å­è®¾ç½®
- **ä½ç½®**: `prepare_training_data.py:172-174`

**æ”¹è¿›å**:
```python
# ç¡®ä¿fallbackè·¯å¾„ä¹Ÿä½¿ç”¨ç›¸åŒçš„éšæœºç§å­ä»¥ä¿è¯å¯é‡ç°æ€§
AllChem.EmbedMolecule(mol, randomSeed=42)
```

---

## ğŸ¯ å½±å“èŒƒå›´åˆ†æ

| ä¿®å¤é¡¹ | å½±å“èŒƒå›´ | ä¸¥é‡ç¨‹åº¦ | ç”¨æˆ·å¯è§æ€§ |
|--------|---------|---------|-----------|
| é—®é¢˜1 | æ‰€æœ‰ç”¨æˆ· | ğŸ”´ ä¸¥é‡ | ç›´æ¥å´©æºƒ |
| é—®é¢˜2 | ä½¿ç”¨SDFé…ä½“çš„ç”¨æˆ· | ğŸ”´ ä¸¥é‡ | ç»“æœé”™è¯¯ |
| é—®é¢˜3 | ä½¿ç”¨é…ç½®æ–‡ä»¶çš„ç”¨æˆ· | ğŸ”´ ä¸¥é‡ | æ— æ³•ä½¿ç”¨ |
| é—®é¢˜4 | ä¸ä½¿ç”¨å¯¹æ¥æ‰“åˆ†çš„ç”¨æˆ· | ğŸŸ¡ ä¸­ç­‰ | è¯„åˆ†åå·® |
| é—®é¢˜5 | ä½¿ç”¨ä¸ç¡®å®šæ€§é€‰æ‹©çš„ç”¨æˆ· | ğŸŸ¡ ä¸­ç­‰ | å¤šæ ·æ€§ä¸‹é™ |
| é—®é¢˜8 | é•¿æ—¶é—´è¿è¡Œç”¨æˆ· | ğŸŸ  è½»å¾® | å†…å­˜å‹åŠ› |
| é—®é¢˜11 | æ‰€æœ‰ç”¨æˆ· | ğŸŸ¢ æ—  | ä»£ç è§„èŒƒ |

---

## ğŸ“¦ æ–°å¢åŠŸèƒ½

### é…ç½®æ–‡ä»¶ç³»ç»Ÿ

1. **YAMLé…ç½®æ–‡ä»¶æ”¯æŒ**
   - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å‚æ•°
   - æ”¯æŒåµŒå¥—ç»“æ„
   - å‚æ•°éªŒè¯å’Œé»˜è®¤å€¼

2. **é¢„è®¾é…ç½®**
   - `default`: é»˜è®¤å¹³è¡¡é…ç½®
   - `quick_test`: å¿«é€Ÿæµ‹è¯•ï¼ˆ3æ¬¡è¿­ä»£ï¼‰
   - `high_quality`: é«˜è´¨é‡æ¨¡å¼ï¼ˆ100è½®è®­ç»ƒï¼‰
   - `fast_training`: å¿«é€Ÿè®­ç»ƒæ¨¡å¼

3. **çµæ´»çš„å‚æ•°ä¼˜å…ˆçº§**
   - é…ç½®æ–‡ä»¶ < é¢„è®¾ < å‘½ä»¤è¡Œå‚æ•°
   - æ”¯æŒéƒ¨åˆ†è¦†ç›–
   - è‡ªåŠ¨éªŒè¯å¿…éœ€å‚æ•°

---

## ğŸ”„ å…¼å®¹æ€§

### å‘åå…¼å®¹
- âœ… å®Œå…¨å…¼å®¹ v1.2 çš„å‘½ä»¤è¡Œå‚æ•°
- âœ… ä¸ä½¿ç”¨é…ç½®æ–‡ä»¶æ—¶è¡Œä¸ºä¸å˜
- âœ… ç°æœ‰è„šæœ¬æ— éœ€ä¿®æ”¹

### å‡çº§å»ºè®®
1. **ç«‹å³å‡çº§** - æ‰€æœ‰ä½¿ç”¨ v1.0-v1.2 çš„ç”¨æˆ·
2. **æµ‹è¯•å»ºè®®** - ä½¿ç”¨å°æ•°æ®é›†éªŒè¯ä¿®å¤æ•ˆæœ
3. **é…ç½®è¿ç§»** - è€ƒè™‘å°†å‘½ä»¤è¡Œå‚æ•°è¿ç§»åˆ° `config.yaml`

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### æ¨èå·¥ä½œæµ

**ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰**:
```bash
# 1. ç¼–è¾‘ config.yaml
vim iterative_learning/config.yaml

# 2. è¿è¡Œ
python iterative_generation.py --config config.yaml
```

**ä½¿ç”¨é¢„è®¾**:
```bash
# å¿«é€Ÿæµ‹è¯•
python iterative_generation.py --preset quick_test

# é«˜è´¨é‡æ¨¡å¼
python iterative_generation.py --preset high_quality
```

**æ··åˆä½¿ç”¨**:
```bash
# é…ç½®æ–‡ä»¶ + é¢„è®¾ + å‘½ä»¤è¡Œè¦†ç›–
python iterative_generation.py \
    --config config.yaml \
    --preset high_quality \
    --batch_size 16 \
    --n_iterations 50
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

ä»¥ä¸‹é—®é¢˜å·²è¯†åˆ«ä½†æœªåœ¨æ­¤ç‰ˆæœ¬ä¿®å¤ï¼ˆè®¡åˆ’åœ¨åç»­ç‰ˆæœ¬å¤„ç†ï¼‰ï¼š

1. **éªŒè¯é›†é—®é¢˜** (é—®é¢˜6): `train_frozen.py` ä½¿ç”¨è®­ç»ƒé›†ä½œä¸ºéªŒè¯é›†
   - å½±å“: æ—©åœæœºåˆ¶å¯èƒ½å¤±æ•ˆ
   - ä¼˜å…ˆçº§: ä¸­
   - è®¡åˆ’: v1.4

2. **LogPæƒ©ç½šæ¸©å’Œ** (é—®é¢˜7): æƒ©ç½šå‡½æ•°å¯èƒ½è¿‡äºæ¸©å’Œ
   - å½±å“: æç«¯LogPå€¼çš„åˆ†å­å¾—åˆ†åé«˜
   - ä¼˜å…ˆçº§: ä½
   - è®¡åˆ’: v1.4

3. **Windowså…¼å®¹æ€§** (é—®é¢˜9): å¤šè¿›ç¨‹æŒ‡çº¹è®¡ç®—åœ¨Windowsä¸Šå¯èƒ½å¤±è´¥
   - å½±å“: å¹¶è¡Œè®¡ç®—é™çº§ä¸ºä¸²è¡Œ
   - ä¼˜å…ˆçº§: ä½
   - è®¡åˆ’: v1.5

---

## ğŸ” æµ‹è¯•å»ºè®®

### å…³é”®æµ‹è¯•ç‚¹

1. **é—®é¢˜1æµ‹è¯•**:
```bash
# è¿è¡Œå®Œæ•´è¿­ä»£ï¼Œç¡®ä¿ç¬¬ä¸€æ¬¡è¿­ä»£ç»Ÿè®¡è®°å½•æ­£å¸¸
python iterative_generation.py --checkpoint ... --n_iterations 2
```

2. **é—®é¢˜2æµ‹è¯•**:
```bash
# ä½¿ç”¨SDFé…ä½“æ–‡ä»¶
python iterative_generation.py --ref_ligand ligand.sdf
```

3. **é—®é¢˜3æµ‹è¯•**:
```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶åŠ è½½
python iterative_generation.py --config config.yaml

# æµ‹è¯•é¢„è®¾
python iterative_generation.py --preset quick_test
```

4. **é—®é¢˜5æµ‹è¯•**:
```bash
# æ£€æŸ¥ä¸ç¡®å®šæ€§åˆ†ææ—¥å¿—ï¼Œç¡®è®¤known_spaceæ•°é‡ä¸€è‡´
tail -f output/uncertainty_analysis/iteration_*_stats.json
```

---

## ğŸ“Š æ€§èƒ½æå‡

| æŒ‡æ ‡ | v1.2 | v1.3 | æ”¹è¿› |
|------|------|------|------|
| å†…å­˜å ç”¨ï¼ˆ30æ¬¡è¿­ä»£ï¼‰ | ~12 GB | ~8 GB | â†“ 33% |
| ç¨³å®šæ€§ï¼ˆå´©æºƒç‡ï¼‰ | 5% | 0% | â†“ 100% |
| é…ç½®ä¾¿åˆ©æ€§ | å‘½ä»¤è¡Œ | YAML | âœ¨ æ–°åŠŸèƒ½ |

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹è´¡çŒ®ï¼š
- ä»£ç å®¡æŸ¥å’Œbugå‘ç°
- é…ç½®æ–‡ä»¶è®¾è®¡åé¦ˆ
- æ–‡æ¡£å®Œå–„å»ºè®®

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](../README.md) - å®Œæ•´ä½¿ç”¨æ–‡æ¡£
- [config.yaml](../config.yaml) - é…ç½®æ–‡ä»¶ç¤ºä¾‹
- [FILES_INDEX.md](FILES_INDEX.md) - æ–‡ä»¶ç´¢å¼•

---

## ğŸ”— ç‰ˆæœ¬å†å²

- **v1.3** (2024-11-03): Bugä¿®å¤ + é…ç½®æ–‡ä»¶æ”¯æŒ
- **v1.2** (2024-10-25): ä¸ç¡®å®šæ€§é€‰æ‹© + å†…å­˜ä¼˜åŒ–
- **v1.1** (2024-10-20): æ—¥å¿—ç³»ç»Ÿ + è®­ç»ƒæ¢å¤
- **v1.0** (2024-10-15): åˆå§‹ç‰ˆæœ¬

---

## ğŸ“ æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ [æ•…éšœæ’é™¤](../README.md#æ•…éšœæ’é™¤) ç« èŠ‚
2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ï¼š`output_dir/logs/training_*.log`
3. åœ¨ GitHub æ Issue

---

**æœ¬ç‰ˆæœ¬å¼ºçƒˆæ¨èæ‰€æœ‰ç”¨æˆ·å‡çº§ï¼** ğŸš€

